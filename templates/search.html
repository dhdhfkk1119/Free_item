<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
</head>
<link href="/static/info.css" rel="stylesheet" type="text/css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link href="https://webfontworld.github.io/gmarket/GmarketSans.css" rel="stylesheet">
<body>
<!-- 헤더 파일 -->
<header class="header">
    {% include 'header.html' %}
</header>
<!-- 메인 -->
<div class="content">
    <div class="content-op">
    </div>
    <div class="content-in">
        <!-- font -->
        <div class="content-wrap">
            <div class="content-text">
                <p class="p-1">장난감</p>
            </div>
        </div>
    </div>
</div>
<div class="content-2">
    <div class="inner">
        <form name="goSearch" method="get" class="toySearch_" action="search" >
            <div class="__schHead">
                    <select id="years_seq" name="age" class="__inp">
                        <option value="none">사용연령</option>
                        <option value=12>12개월 이상</option>
                        <option value=24>24개월 이상</option>
                        <option value=36>36개월 이상</option>
                        <option value=48>48개월 이상</option>
                        <option value=60>60개월 이상</option>
                        <option value="기타">기타</option>
                        <option value="전체연령">전체연령</option>
                    </select>
                <select id="toy_status" name="status" class="__inp">
                    <option value="none">대여상태</option>
                        <option value="대여가능">대여 가능</option>
                        <option value="예약중">예약중</option>
                </select>
                <input type="text" class="__inp" placeholder="장난감 이름/등록 번호" name="searchString" value="">
                <button type="submit">검색</button>
            </div>
        </form>
        <!-- 장난감 정렬  -->
        <div class="__topArea line __mt40">
            <div class="lef">
                <div class="sort">
                    <a href="" class="active">최신순</a>
                    <a href="">조회순</a>
                </div>
            </div>
            <div class="rig">
                <div class="total">총 게시물 <span>{{ total_posts }}</span> 건</div>
            </div>
        </div>
        <!-- 장난감 상품 이미지 -->
        <div class="__toyList">
            {% for item in items %}
            <a href="{{ item['detail_url'] }}" class="box" onclick="increaseViewCount('{{ item['idx'] }}')">
                <div class="img"><img src="{{ item['img_src'] }}" width="150" height="150"></div>
                <div class="info">
                    <div>
                        <span class="subject">{{ item['name'] }}</span>
                        <span class="age">{{ item['age'] }}</span>
                    </div>
                    <div class="state">
                        {% if item['status'] == '대여가능' %}
                        <span class="__btn6 blue2">{{ item['status'] }}</span>
                        {% else %}
                        <span class="__btn6 gray2">{{ item['status'] }}</span>
                        {% endif %}
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</div>
<div class="page_number">
    <div class="page_style">
        <div class="page_inner">
            {% if total_posts > per_page %}
                {% if page > 1 %}
                    <a class="arr num first" href="{{ url_for('info', page=1, per_page=per_page) }}"><img src="../static/image/2.png" class="left" alt="left_first"></a>
                    <a class="arr num prev" href="{{ url_for('info', page=page-1, per_page=per_page) }}"><img src="../static/image/2-.png" class="left" alt="left"></a>
                {% endif %}
                {% set start_page = 1 %}
                {% set end_page = 11 %}
                {% if total_posts // per_page < 10 %}
                    {% set end_page = (total_posts - 1) // per_page + 1 %}
                {% endif %}
                {% if page > 5 %}
                    {% set start_page = page - 4 %}
                    {% set end_page = page + 5 %}
                    {% if end_page > total_posts // per_page + 1 %}
                        {% set end_page = total_posts // per_page + 1 %}
                        {% set start_page = end_page - 9 %}
                    {% endif %}
                {% endif %}
                {% for num in range(start_page, end_page) %}
                <a class="num {% if num == page %}active{% endif %}" href="#" onclick="nextPage({{ num }})">{{ num }}</a>
                {% endfor %}            
                {% if page < total_posts // per_page %}
                    <a class="arr num next" href="{{ url_for('search', page=next_page, per_page=per_page, age=age, status=status, searchString=searchString) }}"><img src="../static/image/1.png" class="right" alt="right" ></a>
                    <a class="arr num last" href="{{ url_for('info', page=total_posts // per_page + 1, per_page=per_page) }}"><img src="../static/image/1-.png" class="right" alt="right_last"></a>
                {% endif %}
            {% endif %}
        </div>            
    </div>      
</div>
</div>

<!-- 푸터 파일 -->
<header class="footer">
    {% include 'footer.html' %}
</header>    

<script>
    window.onload = function() {
        // 페이지가 로드될 때 실행되는 함수

        // 검색 결과가 없으면 안내 메시지를 표시하고, 있으면 숨깁니다.
        var searchResult = document.getElementById("searchResult");
        searchResult.style.display = "{{ 'none' if results else 'block' }}";

        // 검색어와 검색 조건 입력 필드 초기화
        document.getElementById('age').value = "{{ age if years_seq else 'none' }}";
        document.getElementById('status').value = "{{ status if toy_status else 'none' }}";
        document.getElementById('searchString').value = "{{ searchString if searchString else '' }}";
    }

// 같이 검색 파라미터 넘겨주기 
function nextPage(page) {
    var url = window.location.href;
    var newUrl = modifyURL(url, 'page', page);
    window.location.href = newUrl;
}

function modifyURL(url, key, value) {
    var urlParts = url.split('?');
    if (urlParts.length >= 2) {
        var queryParams = urlParts[1].split('&');
        var found = false;
        for (var i = 0; i < queryParams.length; i++) {
            var keyValuePair = queryParams[i].split('=');
            if (keyValuePair[0] === key) {
                keyValuePair[1] = value;
                queryParams[i] = keyValuePair.join('=');
                found = true;
                break;
            }
        }
        if (!found) {
            queryParams.push(key + '=' + value);
        }
        urlParts[1] = queryParams.join('&');
    } else {
        urlParts.push(key + '=' + value);
    }
    return urlParts.join('?');
}

</script>
</body>
</html>
